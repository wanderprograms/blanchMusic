<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Hub | Lite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="website-ui">
        <header>
            <h1>MUSIC HUB</h1>
            <input type="text" id="searchInput" onkeyup="searchSongs()" placeholder="Saka nyimbo...">
        </header>

        <nav class="nav-tabs">
            <button class="tab-btn active" onclick="showSection('top-section', this)">TOP 10</button>
            <button class="tab-btn" onclick="showSection('new-section', this)">ZATSOPANO</button>
            <button class="tab-btn" onclick="showSection('old-section', this)">ZAPAKANTHAWI</button>
            <button class="tab-btn" onclick="showSection('all-section', this)">ALL MUSIC</button>
        </nav>

        <main>
            <section id="top-section" class="music-section active">
                <h2 class="section-title">TOP 10 HITS</h2>
                <div class="grid" id="top-10-grid"></div>
            </section>

            <section id="new-section" class="music-section">
                <h2 class="section-title">ZATSOPANO</h2>
                <div class="grid" id="new-grid"></div>
            </section>

            <section id="old-section" class="music-section">
                <h2 class="section-title">ZAPAKANTHAWI</h2>
                <div class="grid" id="old-grid"></div>
            </section>

            <section id="all-section" class="music-section">
                <h2 class="section-title">ALL MUSIC</h2>
                <div class="grid" id="all-grid"></div>
            </section>
        </main>

        <button id="backToTop" onclick="scrollToTop()"><i class="fas fa-arrow-up"></i></button>

        <div class="footer-player">
            <div id="playing-title">Sankhani nyimbo...</div>
            <audio id="mainAudio" controls></audio>
        </div>
    </div>

    <div id="embed-view" style="display:none; padding:10px; background:#000;">
        <p id="embed-title" style="color:#1db954; font-size:12px; font-family:sans-serif; margin-bottom:5px;"></p>
        <audio id="embedAudio" controls style="width:100%; height:30px;"></audio>
    </div>

    <div id="shareModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeShare()">&times;</span>
            <p style="font-size:14px;">Gawirani: <strong id="share-name"></strong></p>
            <div class="share-options">
                <button onclick="shareTo('whatsapp')"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                <button onclick="shareTo('facebook')"><i class="fab fa-facebook-f"></i> Facebook</button>
                <button onclick="copyLink()"><i class="fas fa-link"></i> Copy Link</button>
                <button onclick="copyEmbed()"><i class="fas fa-code"></i> Copy Embed</button>
            </div>
        </div>
    </div>

    <div id="promoModal" style="display: none; position: fixed; z-index: 9999; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(5px);">
    <div style="background: #1a1a1a; margin: 15% auto; width: 85%; max-width: 350px; border-radius: 15px; overflow: hidden; border: 1px solid #333; text-align: center; font-family: sans-serif;">
        <img src="images/malonda.jpg" style="width: 100%; height: 180px; object-fit: cover;">
        <div style="padding: 15px; font-size: 0.9rem; color: #eee; line-height: 1.4;">
            <p>Timapanga zinthu monga; ma card awukwati, ma logo, artwork ndi zina zambili. tipezei pa website yathu <a href="https://wanderprograms.github.io/wanderSlapp/" target="_blank" style="color: #1db954; text-decoration: none; font-weight: bold;">wanderslapp.com</a> kuti munve zambiri.</p>
            <p>Olonso mutha kulumikizana nafe pa whatsapp, pangani Go Now, kuti muziwe zambili pa whatsapp</p>
        </div>
        <div style="display: flex; border-top: 1px solid #333;">
            <button id="notNowBtn" style="flex: 1; padding: 15px; background: #222; color: #888; border: none; border-right: 1px solid #333; cursor: pointer; font-weight: bold;">NOT NOW</button>
            <button id="goNowBtn" style="flex: 1; padding: 15px; background: #1db954; color: black; border: none; cursor: pointer; font-weight: bold;">GO NOW</button>
        </div>
    </div>
</div>

<script>
// GLOBAL INTERCEPTOR SCRIPT
(function() {
    let lastEvent = null;

    // 1. Yang'anirani zimene munthu akudina pa screen yonse
    document.addEventListener('click', function(e) {
        // Sakani ngati wadina button kapena icon ya play, download, kapena share
        let target = e.target.closest('button, .img-container, .btn-item');
        
        if (target && !e.target.closest('#promoModal')) {
            // Ngati wadina chinachake chomwe chili ndi "handlePlay", "handleDown", kapena "openShare"
            let onclickAttr = target.getAttribute('onclick');
            
            if (onclickAttr && (onclickAttr.includes('handle') || onclickAttr.includes('openShare'))) {
                // Imaitsani action yomwe ikanafuna kuchitika
                e.stopImmediatePropagation();
                e.preventDefault();
                
                // Sungani chimene munthu uyu akufuna kuchita
                lastEvent = {
                    element: target,
                    action: onclickAttr
                };
                
                // Onetsani Malonda
                document.getElementById('promoModal').style.display = 'block';
            }
        }
    }, true); // "true" imapangitsa kuti izi zichitike poyamba asanachite zina

    // 2. GO NOW (WhatsApp)
    document.getElementById('goNowBtn').onclick = function() {
        window.open("https://wa.me/265990914737?text=Ndikufuna kudziwa zambiri za malonda omwe ndawona pa Music Hub", "_blank");
    };

    // 3. NOT NOW (Bwererani pa site ndikuapitiliza zomwe amachita)
    document.getElementById('notNowBtn').onclick = function() {
        document.getElementById('promoModal').style.display = 'none';
        if (lastEvent) {
            // Chotsani "onclick" kwakanthawi kuti isadzatulutse malonda kachiwiri
            let originalOnClick = lastEvent.element.onclick;
            lastEvent.element.onclick = null;
            
            // Chititsani action ija yomwe munthu amafuna (Play/Download/Share)
            eval(lastEvent.action);
            
            // Mayi bweretsani onclick ija pambuyo pa masekondi pang'ono
            setTimeout(() => {
                lastEvent.element.onclick = originalOnClick;
                lastEvent = null;
            }, 500);
        }
    };
})();
</script>

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script src="script.js"></script>
</body>
</html>